var e,n=(e=require("json-refactor"))&&"object"==typeof e&&"default"in e?e.default:e,o={optionsCollection:{},env:0};var t={errorField:"error",debug:!0},r=function(e){for(var n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];console.info.apply(console,["see-fetch: "+e].concat(n))},i=function(e){for(var n=[],o=arguments.length-1;o-- >0;)n[o]=arguments[o+1];console.error.apply(console,["see-fetch: "+e].concat(n))};function s(e){var n;return e.status>=300?((n={})[t.errorField]=!0,n.response=e,n):e.json()}function c(e,t,r){var i=o.optionsCollection[r],s=o.optionsCollection.common||{},c=o.env,f=i.responseRefactor&&i.responseRefactor[c],a=s.responseRefactor&&s.responseRefactor[c],u=i.postHandle&&i.postHandle[c],l=s.postHandle&&s.postHandle[c],p=e;if(a&&n(p,a),f&&n(p,f),l){var d=l(p,t,r);d&&(p=d)}if(u){var v=u(p,t,r);v&&(p=v)}return p}function f(e,n){return function(o){return o[t.errorField]?o:c(o,n,e)}}function a(e,n){if(e){var a=o.optionsCollection[e],u=o.optionsCollection.common||{};if(a){var l=o.env,p=a.method&&a.method[l]||"get",d=a.stringify&&a.stringify[l]||!1,v=a.settings&&a.settings[l]||{},h=a.url&&a.url[l]||"",m=a.requestKeys&&a.requestKeys[l]||{},g=a.preHandle&&a.preHandle[l],y=u.preHandle&&u.preHandle[l],b=a.implement&&a.implement[l],j=Object.assign({},n||{});if(Object.keys(j).forEach(function(e){var n=m[e];n&&"string"==typeof n&&(j[n]=j[e],delete j[e])}),y){var O=y(j);O&&(j=O)}if(g){var E=g(j);E&&(j=E)}if(b)return new Promise(function(n){var o=function(o){t.debug&&(r("custom fetch implement for '"+e+"', and request params is:",j),r("result for '"+e+"' is:",o)),n(c(o,j,e))},i=b(function(e){o(e)},d?JSON.stringify(j):j);i&&i instanceof Promise&&i.then(function(e){o(e)})});if(v.method=p,"get"===p||"GET"===p){var H=h+(h.indexOf("?")<0?"?":"&")+function(e){if(!e)return"";var n=[];return Object.keys(e).forEach(function(o){n.push(o+"="+(void 0===e[o]?"":e[o]))}),n.join("&")}(j);return fetch(H,v).then(s).then(f(e,j))}return v.body=d?JSON.stringify(j):function(e){var n=new URLSearchParams;return e?(Object.keys(e).forEach(function(o){n.append(o,void 0===e[o]?"":e[o])}),n):n}(j),fetch(h,v).then(s).then(f(e,j))}i("name '"+e+"' is not configured.")}}a.config=function(e,n){"string"==typeof e?o.optionsCollection[e]=n:Object.keys(e).forEach(function(n){o.optionsCollection[n]=e[n]})},a.setEnv=function(e){o.env=e},a.getEnv=function(){return o.env},a.set=function(e){e&&Object.keys(e).forEach(function(n){t[n]=e[n]})},module.exports=a;
//# sourceMappingURL=see-fetch.js.map
